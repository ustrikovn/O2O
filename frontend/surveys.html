<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø—Ä–æ—Å—ã - O2O</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="shared/styles/base.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ */
        .option-card {
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .option-label {
            display: block;
            cursor: pointer;
            padding: 18px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .option-label:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .option-radio {
            display: none;
        }
        
        .option-content {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .option-check {
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        
        .option-check::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 12px;
            height: 12px;
            background: #3b82f6;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .option-text {
            font-size: 15px;
            line-height: 1.5;
            color: #374151;
            font-weight: 500;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .option-card.selected .option-label {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .option-card.selected .option-check {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .option-card.selected .option-check::after {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .option-card.selected .option-text {
            color: #1e40af;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–∫–æ–Ω–∫–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
        .rotate-180 {
            transform: rotate(180deg);
        }
        
        /* –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è –∫ –ø–æ–¥—Å–∫–∞–∑–∫–µ */
        @keyframes hint-pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.02);
            }
        }
        
        .hint-animate {
            animation: hint-pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="flex min-h-screen">
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>
        
        <!-- Main Content -->
        <div class="flex-1 ml-64 p-8">
            <div class="max-w-6xl mx-auto">
                <!-- –í—ã–±–æ—Ä –æ–ø—Ä–æ—Å–∞ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <!-- –í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                            <i data-feather="user" class="mr-2 w-5 h-5"></i>
                            –í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        </h2>
                        <div class="space-y-3">
                            <div id="employee-dropdown-container"></div>
                            <div id="employee-info" class="text-sm text-gray-600 p-3 bg-gray-50 rounded-lg hidden">
                                <div class="flex items-center space-x-3">
                                    <img id="employee-avatar" src="" alt="" class="w-10 h-10 rounded-full bg-gray-200">
                                    <div>
                                        <p id="employee-name" class="font-medium"></p>
                                        <p id="employee-position" class="text-gray-500"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –í—ã–±–æ—Ä –æ–ø—Ä–æ—Å–∞ -->
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                            <i data-feather="clipboard" class="mr-2 w-5 h-5"></i>
                            –í—ã–±–æ—Ä –æ–ø—Ä–æ—Å–∞
                        </h2>
                        <div class="space-y-3">
                            <div id="survey-dropdown-container"></div>
                            <!-- Hidden input –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º -->
                            <input type="hidden" id="survey-select" value="">
                            <div id="survey-description" class="text-sm text-gray-600 p-3 bg-gray-50 rounded-lg hidden">
                                <p>–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞ -->
                <div class="glass-card p-4 mb-6" id="survey-status-card" style="display: none;">
                    <div id="survey-status-content">
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å—Ç–∞—Ç—É—Å–Ω—ã–π –±–ª–æ–∫ -->
                    <div class="mt-4 pt-4 border-t border-gray-200" id="survey-actions">
                        <div class="flex flex-wrap gap-3">
                            <button id="start-survey-btn" class="glass-button px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-sm">
                                <i data-feather="play" class="mr-2 w-4 h-4 inline"></i>
                                –ù–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å
                            </button>
                            <button id="view-results-btn" class="glass-button px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:shadow-lg text-sm" style="display: none;">
                                <i data-feather="eye" class="mr-2 w-4 h-4 inline"></i>
                                –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                            </button>
                            <button id="retake-survey-btn" class="glass-button px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:shadow-lg text-sm" style="display: none;">
                                <i data-feather="refresh-cw" class="mr-2 w-4 h-4 inline"></i>
                                –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞ -->
            <div class="glass-card p-6 hidden" id="survey-taking-interface">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                        <i data-feather="help-circle" class="mr-2"></i>
                        <span id="survey-taking-title">–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞</span>
                    </h2>
                    <button onclick="cancelSurvey()" class="glass-button px-4 py-2 rounded-lg flex items-center">
                        <i data-feather="x" class="mr-2"></i>
                        –û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
                
                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
                <div class="mb-6">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</span>
                        <span id="progress-text">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- –ë–ª–æ–∫ —Å–µ–∫—Ü–∏–∏ -->
                <div id="section-indicator" class="mb-6 pl-4 border-l-4 border-blue-500 hidden">
                    <h4 id="section-title" class="text-base font-semibold text-gray-900 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏</h4>
                    <p id="section-description" class="text-sm text-gray-600">–û–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏</p>
                </div>
                
                <!-- –í–æ–ø—Ä–æ—Å -->
                <div id="question-container">
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-gray-800 mb-4" id="question-title">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...</h3>
                        <div id="question-options" class="space-y-3">
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    
                    <div class="flex justify-between mt-6">
                        <button onclick="previousQuestion()" id="prev-btn" class="glass-button px-4 py-2 rounded-lg flex items-center disabled:opacity-50" disabled>
                            <i data-feather="chevron-left" class="mr-2"></i>
                            –ù–∞–∑–∞–¥
                        </button>
                        <button onclick="nextQuestion()" id="next-btn" class="glass-button px-4 py-2 rounded-lg flex items-center disabled:opacity-50" disabled>
                            –î–∞–ª–µ–µ
                            <i data-feather="chevron-right" class="ml-2"></i>
                        </button>
                    </div>
                </div>
                
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞ -->
                <div id="survey-completion" class="hidden text-center">
                    <div class="mb-6">
                        <i data-feather="check-circle" class="mx-auto text-green-500 mb-4" style="width: 64px; height: 64px;"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">–û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω!</h3>
                        <p class="text-gray-600">–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ. –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.</p>
                    </div>
                    <div class="space-y-3">
                        <button onclick="viewSurveyResults()" class="glass-button px-6 py-3 rounded-lg flex items-center mx-auto">
                            <i data-feather="eye" class="mr-2"></i>
                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        </button>
                        <button onclick="startNewSurvey()" class="glass-button px-6 py-3 rounded-lg flex items-center mx-auto">
                            <i data-feather="refresh-cw" class="mr-2"></i>
                            –ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π –æ–ø—Ä–æ—Å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="shared/ui/sidebar.js"></script>
    <script src="shared/ui/modal.js"></script>
    <script src="shared/ui/employee-selector-modal.js"></script>
    <script src="shared/ui/meeting-initiator.js"></script>
    <script src="shared/ui/active-meeting-modal.js"></script>
    <script src="shared/ui/custom-dropdown.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è sidebar
        if (typeof O2OSidebar !== 'undefined') {
            const sidebar = new O2OSidebar('surveys');
            sidebar.mount('sidebar-container');
            sidebar.startActiveMeetingCheck();
        }
        
        /**
         * –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ "–í—Å—Ç—Ä–µ—á–∞" –≤ —Å–∞–π–¥–±–∞—Ä–µ
         */
        async function startMeetingFromSidebar(event) {
            event.preventDefault();
            
            // –ï—Å–ª–∏ —É–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Å—Ç—Ä–µ—á–∏, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
            if (window.location.pathname.includes('conduct-meeting.html')) {
                return;
            }
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞
                const response = await fetch('http://localhost:3001/api/meetings/active');
                const result = await response.json();
                
                if (response.ok && result.success && result.data) {
                    // –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –Ω–µ—ë
                    const activeMeeting = result.data;
                    window.location.href = `conduct-meeting.html?employeeId=${activeMeeting.employeeId}&meetingId=${activeMeeting.id}`;
                } else {
                    // –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É
                    window.meetingInitiator.initiateMeeting();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É
                window.meetingInitiator.initiateMeeting();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Feather –∏–∫–æ–Ω–æ–∫
        if (typeof feather !== 'undefined') {
            feather.replace();
        }

        // === –î–ê–ù–ù–´–ï ===
        let surveys = [];
        let employees = [];

        // === –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let selectedSurvey = '';
        let selectedEmployee = '';
        let employeeDropdown = null;
        let surveyDropdown = null;
        
        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ü–†–û–•–û–ñ–î–ï–ù–ò–Ø –û–ü–†–û–°–ê ===
        let currentSurveyResult = null;
        let currentQuestion = null;
        let currentQuestionIndex = 0;
        let surveyQuestions = [];
        let answers = {};
        let questionHistory = []; // –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        let isTakingSurvey = false;
        let currentSection = null; // –¢–µ–∫—É—â–∞—è —Å–µ–∫—Ü–∏—è
        let currentSurvey = null; // –¢–µ–∫—É—â–∏–π –æ–ø—Ä–æ—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
        let hintAnimationTimer = null; // –¢–∞–π–º–µ—Ä –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', function() {
            loadSurveys();
            loadEmployees();
            setupEventListeners();
            initializeEmployeeDropdown();
            initializeSurveyDropdown();
            feather.replace();
        });

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–´–ü–ê–î–ê–Æ–©–ï–ì–û –°–ü–ò–°–ö–ê –û–ü–†–û–°–û–í ===
        function initializeSurveyDropdown() {
            surveyDropdown = new CustomDropdown({
                placeholder: '–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ä–æ—Å...',
                maxVisibleItems: 3,
                enableSearch: false,
                formatItem: function(survey) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ 80 —Å–∏–º–≤–æ–ª–æ–≤ –æ–ø–∏—Å–∞–Ω–∏—è
                    const shortDescription = survey.description && survey.description.length > 80 
                        ? survey.description.substring(0, 80) + '...' 
                        : survey.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ';
                    
                    return `
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-primary rounded-full mt-2 opacity-60"></div>
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-gray-900 truncate">
                                    ${survey.title}
                                </div>
                                <div class="text-xs text-gray-500 mt-1 truncate">${shortDescription}</div>
                            </div>
                        </div>
                    `;
                },
                onChange: function(survey) {
                    selectedSurvey = survey.id;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                    document.getElementById('survey-select').value = survey.id;
                    
                    // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    updateSurveyStatus();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞
                    showSurveyDescription(survey);
                    
                    console.log('–í—ã–±—Ä–∞–Ω –æ–ø—Ä–æ—Å:', survey.id, survey.title);
                }
            });

            surveyDropdown.mount('survey-dropdown-container');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ä–æ—Å—ã –∏–∑ API –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è dropdown
            loadSurveysIntoDropdown();
        }
        
        function showSurveyDescription(survey) {
            const descriptionEl = document.getElementById('survey-description');
            
            if (survey && survey.description) {
                descriptionEl.querySelector('p').textContent = survey.description;
                descriptionEl.classList.remove('hidden');
            } else {
                descriptionEl.classList.add('hidden');
            }
        }
        
        // === –ó–ê–ì–†–£–ó–ö–ê –û–ü–†–û–°–û–í –í DROPDOWN ===
        async function loadSurveysIntoDropdown() {
            try {
                const response = await fetch('http://localhost:3001/api/surveys?active=true');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const surveysFromAPI = data.data || [];

                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø—Ä–æ—Å–æ–≤ –∏–∑ API:', surveysFromAPI.length);
                
                if (surveyDropdown && surveysFromAPI.length > 0) {
                    surveyDropdown.setItems(surveysFromAPI);
                } else {
                    console.warn('–û–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ dropdown –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è dropdown:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º dropdown –ø—É—Å—Ç—ã–º
            }
        }

        // === –ó–ê–ì–†–£–ó–ö–ê –û–ü–†–û–°–û–í ===
        async function loadSurveys() {
            try {
                const response = await fetch('http://localhost:3001/api/surveys?active=true');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                surveys = data.data || [];

                console.log('–û—Ç–≤–µ—Ç API –æ–ø—Ä–æ—Å–æ–≤:', data);
                console.log('–ú–∞—Å—Å–∏–≤ –æ–ø—Ä–æ—Å–æ–≤:', surveys);
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${surveys.length} –æ–ø—Ä–æ—Å–æ–≤`);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–ø—Ä–æ—Å–æ–≤:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ API, dropdown –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
            }
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–´–ü–ê–î–ê–Æ–©–ï–ì–û –°–ü–ò–°–ö–ê –°–û–¢–†–£–î–ù–ò–ö–û–í ===
        function initializeEmployeeDropdown() {
            employeeDropdown = new CustomDropdown({
                placeholder: '–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...',
                maxVisibleItems: 2.5,
                enableSearch: false,
                formatItem: function(employee) {
                    // –°–æ–∑–¥–∞–µ–º –∞–≤–∞—Ç–∞—Ä (–∏–Ω–∏—Ü–∏–∞–ª—ã –∏–ª–∏ —Ñ–æ—Ç–æ)
                    const initials = `${employee.first_name.charAt(0)}${employee.last_name.charAt(0)}`;
                    const avatarHtml = employee.photoUrl 
                        ? `<img src="${employee.photoUrl}" alt="${employee.first_name} ${employee.last_name}" class="w-8 h-8 rounded-full object-cover">`
                        : `<div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-medium">${initials}</div>`;

                    return `
                        <div class="flex items-center space-x-3">
                            ${avatarHtml}
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-gray-900 truncate">
                                    ${employee.first_name} ${employee.last_name}
                                </div>
                                <div class="text-sm text-gray-600 truncate">${employee.position}</div>
                            </div>
                        </div>
                    `;
                },
                onChange: function(employee) {
                    selectedEmployee = employee.id;
                    updateEmployeeInfo();
                    updateSurveyStatus();
                }
            });

            employeeDropdown.mount('employee-dropdown-container');
        }

        // === –ó–ê–ì–†–£–ó–ö–ê –°–û–¢–†–£–î–ù–ò–ö–û–í ===
        async function loadEmployees() {
            try {
                const response = await fetch('http://localhost:3001/api/employees');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
                }
                
                const data = await response.json();
                employees = data.data || [];

                console.log('–û—Ç–≤–µ—Ç API —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', data);
                console.log('–ú–∞—Å—Å–∏–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', employees);

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
                if (employeeDropdown) {
                    employeeDropdown.setItems(employees);
                }

                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${employees.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', error);
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –ü–†–û–•–û–ñ–î–ï–ù–ò–Ø –û–ü–†–û–°–ê ===
        function initializeSurveyTaking(survey, employee) {
            isTakingSurvey = true;
            answers = {};
            questionHistory = []; // –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            currentQuestionIndex = 0;
            currentSection = null;
            currentSurvey = survey; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø—Ä–æ—Å
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞
            document.getElementById('survey-taking-interface').classList.remove('hidden');
            document.getElementById('survey-taking-title').textContent = survey.title;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Å—Ç–∞—Ç—É—Å–Ω—ã–π –±–ª–æ–∫
            document.querySelector('.grid').style.display = 'none';
            document.getElementById('survey-status-card').style.display = 'none';
            
            feather.replace();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        function updateBackButton() {
            const prevBtn = document.getElementById('prev-btn');
            if (prevBtn) {
                prevBtn.disabled = questionHistory.length === 0;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)
        window.toggleHints = function(hintsId) {
            const hintsElement = document.getElementById(hintsId);
            const iconElement = document.getElementById(`${hintsId}-icon`);
            const buttonElement = iconElement.closest('button');
            
            if (hintsElement.classList.contains('hidden')) {
                hintsElement.classList.remove('hidden');
                iconElement.classList.add('rotate-180');
            } else {
                hintsElement.classList.add('hidden');
                iconElement.classList.remove('rotate-180');
            }
            
            // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É
            if (buttonElement) {
                buttonElement.classList.remove('hint-animate');
            }
            
            feather.replace();
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–µ–∫—Ü–∏–∏
        function updateSectionIndicator(question) {
            if (!question || !question.section || !currentSurvey?.metadata?.sections) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ–∫—Ü–∏–∏
                document.getElementById('section-indicator').classList.add('hidden');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–º–µ–Ω–∏–ª–∞—Å—å –ª–∏ —Å–µ–∫—Ü–∏—è
            if (currentSection === question.section) {
                // –°–µ–∫—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                return;
            }

            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–∫—Ü–∏–∏
            const section = currentSurvey.metadata.sections.find(s => s.id === question.section);
            if (!section) {
                document.getElementById('section-indicator').classList.add('hidden');
                return;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å–µ–∫—Ü–∏—é
            currentSection = question.section;

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            const indicator = document.getElementById('section-indicator');
            const titleElement = document.getElementById('section-title');
            const descriptionElement = document.getElementById('section-description');

            titleElement.textContent = section.title;
            descriptionElement.textContent = section.description || '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            indicator.classList.remove('hidden');
        }


        function displayQuestion(question, restorePreviousAnswer = false) {
            const titleElement = document.getElementById('question-title');
            const optionsElement = document.getElementById('question-options');
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
            if (hintAnimationTimer) {
                clearTimeout(hintAnimationTimer);
                hintAnimationTimer = null;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–µ–∫—Ü–∏–∏
            updateSectionIndicator(question);
            
            titleElement.textContent = question.title;
            optionsElement.innerHTML = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
            updateBackButton();
            
            if (question.type === 'single-choice') {
                // –û—Ç–ª–∞–¥–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –ø—Ä–∏—à–ª–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                console.log(`üìã –û–ø—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–∞ ${question.id}:`, question.options);
                
                question.options.forEach((option, idx) => {
                    const optionId = `option-${question.id}-${idx}`;
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option-card';
                    optionDiv.innerHTML = `
                        <label for="${optionId}" class="option-label">
                            <input type="radio" id="${optionId}" name="question-answer" value="${option.value}" class="option-radio">
                            <div class="option-content">
                                <div class="option-check"></div>
                                <span class="option-text">${option.label}</span>
                            </div>
                        </label>
                    `;
                    optionsElement.appendChild(optionDiv);
                });
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
                if (restorePreviousAnswer && answers[question.id]) {
                    const previousAnswer = String(answers[question.id]).toUpperCase();
                    const radioToSelect = Array.from(document.querySelectorAll(`input[name="question-answer"]`))
                        .find(inp => String(inp.value).toUpperCase() === previousAnswer);
                    if (radioToSelect) {
                        radioToSelect.checked = true;
                        radioToSelect.closest('.option-card').classList.add('selected');
                        document.getElementById('next-btn').disabled = false;
                    }
                }
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ" –∫–æ–≥–¥–∞ –≤—ã–±—Ä–∞–Ω –æ—Ç–≤–µ—Ç
                document.querySelectorAll('input[name="question-answer"]').forEach(input => {
                    input.addEventListener('change', () => {
                        document.getElementById('next-btn').disabled = false;
                        
                        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                        document.querySelectorAll('.option-card').forEach(card => {
                            card.classList.remove('selected');
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
                        input.closest('.option-card').classList.add('selected');
                    });
                });
            } else if (question.type === 'textarea' || question.type === 'text') {
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
                const textareaDiv = document.createElement('div');
                textareaDiv.className = 'w-full';
                
                const rows = question.rows || 5;
                const placeholder = question.placeholder || '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç...';
                const maxLength = question.maxLength || 1000;
                
                // –°–æ–±–∏—Ä–∞–µ–º HTML –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ (—Ç–µ–ø–µ—Ä—å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è)
                let hintsHtml = '';
                let hasHints = false;
                if (question.hints && question.hints.length > 0) {
                    hasHints = true;
                    const hintsId = `hints-${question.id}`;
                    const hintButtonId = `hint-btn-${question.id}`;
                    hintsHtml = `
                        <div class="mt-3">
                            <button 
                                id="${hintButtonId}"
                                type="button"
                                onclick="toggleHints('${hintsId}')"
                                class="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 transition-colors"
                            >
                                <i data-feather="help-circle" class="w-4 h-4"></i>
                                <span>–ü–æ–¥—Å–∫–∞–∑–∫–∞</span>
                                <i id="${hintsId}-icon" data-feather="chevron-down" class="w-4 h-4 transition-transform"></i>
                            </button>
                            <div id="${hintsId}" class="hidden mt-2 pl-6 space-y-1.5">
                                ${question.hints.map(hint => `
                                    <div class="text-sm text-gray-600 flex items-start">
                                        <span class="mr-2 text-gray-400">‚Ä¢</span>
                                        <span>${hint}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                textareaDiv.innerHTML = `
                    <textarea 
                        id="text-answer" 
                        name="question-answer" 
                        rows="${rows}"
                        maxlength="${maxLength}"
                        placeholder="${placeholder}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y"
                    ></textarea>
                    <div class="flex justify-between mt-2 text-sm text-gray-500">
                        <span>–ú–∏–Ω–∏–º—É–º ${question.validation?.minLength || 20} —Å–∏–º–≤–æ–ª–æ–≤</span>
                        <span id="char-count">0 / ${maxLength}</span>
                    </div>
                    ${hintsHtml}
                `;
                
                optionsElement.appendChild(textareaDiv);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
                const textarea = document.getElementById('text-answer');
                const charCount = document.getElementById('char-count');
                const nextBtn = document.getElementById('next-btn');
                const minLength = question.validation?.minLength || 20;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
                if (restorePreviousAnswer && answers[question.id]) {
                    textarea.value = answers[question.id];
                    const length = textarea.value.length;
                    charCount.textContent = `${length} / ${maxLength}`;
                    if (length >= minLength) {
                        nextBtn.disabled = false;
                    }
                }
                
                textarea.addEventListener('input', () => {
                    const length = textarea.value.length;
                    charCount.textContent = `${length} / ${maxLength}`;
                    
                    // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ" —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –º–∏–Ω–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤
                    if (length >= minLength) {
                        nextBtn.disabled = false;
                        textarea.classList.remove('border-red-300');
                    } else {
                        nextBtn.disabled = true;
                        if (length > 0) {
                            textarea.classList.add('border-red-300');
                        }
                    }
                });
                
                // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞
                nextBtn.disabled = true;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ feather –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
                feather.replace();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥—Å–∫–∞–∑–∫–∏ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                if (hasHints) {
                    const hintButtonId = `hint-btn-${question.id}`;
                    hintAnimationTimer = setTimeout(() => {
                        const hintButton = document.getElementById(hintButtonId);
                        if (hintButton && !hintButton.classList.contains('rotate-180')) {
                            hintButton.classList.add('hint-animate');
                        }
                    }, 10000); // 10 —Å–µ–∫—É–Ω–¥
                }
            }
        }

        async function nextQuestion() {
            let answer;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞
            if (currentQuestion.type === 'textarea' || currentQuestion.type === 'text') {
                // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –±–µ—Ä–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ textarea
                const textAnswer = document.getElementById('text-answer');
                if (!textAnswer || !textAnswer.value.trim()) return;
                answer = textAnswer.value.trim();
            } else {
                // –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –≤—ã–±–æ—Ä–æ–º –±–µ—Ä–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                const selectedOption = document.querySelector('input[name="question-answer"]:checked');
                if (!selectedOption) return;
                answer = selectedOption.value;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
            questionHistory.push({
                question: currentQuestion,
                answer: answer
            });
            
            answers[currentQuestion.id] = answer;

            try {
                // –û—Ç–ª–∞–¥–∫–∞: –≤—ã–≤–æ–¥–∏–º —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç:', {
                    questionId: currentQuestion.id,
                    value: answer,
                    selectedOption: document.querySelector('input[name="question-answer"]:checked')?.value
                });
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('http://localhost:3001/api/surveys/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resultId: currentSurveyResult.id,
                        questionId: currentQuestion.id,
                        value: answer
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', data);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–ø—Ä–æ—Å–∞
                if (data.data.isCompleted) {
                    // –û–ø—Ä–æ—Å —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
                    console.log('–û–ø—Ä–æ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥–µ');
                    showSurveyCompletion();
                    await updateSurveyStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                } else if (data.data.question) {
                    // –ï—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
                    currentQuestion = data.data.question;
                    displayQuestion(currentQuestion);
                    updateProgress(data.data.progress);
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ"
                    document.getElementById('next-btn').disabled = true;
                } else {
                    // –°—Ç—Ä–∞–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è - –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–∞, –Ω–æ –æ–ø—Ä–æ—Å –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω
                    console.warn('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–∞, –Ω–æ –æ–ø—Ä–æ—Å –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω');
                    showSurveyCompletion();
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç');
            }
        }

        async function completeSurvey() {
            try {
                const response = await fetch('http://localhost:3001/api/surveys/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resultId: currentSurveyResult.id
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('–û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω:', data);
                
                showSurveyCompletion();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
                updateSurveyStatus();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø—Ä–æ—Å–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–æ—Å');
            }
        }

        function showSurveyCompletion() {
            document.getElementById('question-container').classList.add('hidden');
            document.getElementById('survey-completion').classList.remove('hidden');
            updateProgress({ percentage: 100 });
            feather.replace();
        }

        function updateProgress(progress) {
            if (progress && progress.percentage !== undefined) {
                document.getElementById('progress-bar').style.width = `${progress.percentage}%`;
                document.getElementById('progress-text').textContent = `${progress.percentage}%`;
            }
        }

        function cancelSurvey() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞? –ü—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
                resetSurveyInterface();
            }
        }

        function previousQuestion() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏—Å—Ç–æ—Ä–∏—è
            if (questionHistory.length === 0) return;
            
            // –î–æ—Å—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
            const previousEntry = questionHistory.pop();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å
            currentQuestion = previousEntry.question;
            
            // –ù–ï —É–¥–∞–ª—è–µ–º –æ—Ç–≤–µ—Ç –∏–∑ answers, —á—Ç–æ–±—ã –æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
            // answers –æ—Å—Ç–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞
            displayQuestion(currentQuestion, true);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ" (–æ–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ/–≤–≤–æ–¥–µ)
            document.getElementById('next-btn').disabled = false;
        }

        function viewSurveyResults() {
            resetSurveyInterface();
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
        }

        function startNewSurvey() {
            resetSurveyInterface();
        }

        function resetSurveyInterface() {
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
            document.getElementById('survey-taking-interface').classList.add('hidden');
            document.getElementById('question-container').classList.remove('hidden');
            document.getElementById('survey-completion').classList.add('hidden');
            document.getElementById('section-indicator').classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.querySelector('.grid').style.display = 'grid';
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
            if (hintAnimationTimer) {
                clearTimeout(hintAnimationTimer);
                hintAnimationTimer = null;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            isTakingSurvey = false;
            currentSurveyResult = null;
            currentQuestion = null;
            currentSection = null;
            currentSurvey = null;
            answers = {};
            questionHistory = []; // –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å (–±–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∫–∞–∂–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ updateSurveyStatus)
            updateSurveyStatus();
        }

        // === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ===
        function setupEventListeners() {
            // –í—ã–±–æ—Ä –æ–ø—Ä–æ—Å–∞
            document.getElementById('survey-select').addEventListener('change', function(e) {
                selectedSurvey = e.target.value;
                updateSurveyDescription();
                updateSurveyStatus();
            });

            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            document.getElementById('start-survey-btn').addEventListener('click', startSurvey);
            document.getElementById('view-results-btn').addEventListener('click', viewResults);
            document.getElementById('retake-survey-btn').addEventListener('click', retakeSurvey);
        }

        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–ü–ò–°–ê–ù–ò–Ø –û–ü–†–û–°–ê ===
        function updateSurveyDescription() {
            const descriptionDiv = document.getElementById('survey-description');
            
            if (selectedSurvey) {
                const survey = surveys.find(s => s.id === selectedSurvey);
                if (survey) {
                    const estimatedTime = survey.metadata?.estimatedDuration ? `${survey.metadata.estimatedDuration} –º–∏–Ω—É—Ç` : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    const questionsCount = survey.questions?.length || 0;
                    
                    descriptionDiv.innerHTML = `
                        <div class="space-y-2">
                            <p class="font-medium">${survey.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                            <div class="flex flex-wrap gap-4 text-xs text-gray-500">
                                <span class="flex items-center"><i data-feather="clock" class="w-3 h-3 mr-1"></i> ${estimatedTime}</span>
                                <span class="flex items-center"><i data-feather="help-circle" class="w-3 h-3 mr-1"></i> ${questionsCount} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                            </div>
                        </div>
                    `;
                    descriptionDiv.classList.remove('hidden');
                    feather.replace();
                } else {
                    descriptionDiv.classList.add('hidden');
                }
            } else {
                descriptionDiv.classList.add('hidden');
            }
        }

        // === –ó–ê–ì–†–£–ó–ö–ê –°–¢–ê–¢–£–°–ê –ü–†–û–•–û–ñ–î–ï–ù–ò–Ø –û–ü–†–û–°–û–í ===
        async function loadSurveyResults() {
            if (!selectedEmployee || !selectedSurvey) return null;
            
            try {
                const response = await fetch(`http://localhost:3001/api/surveys/${selectedSurvey}/results?employeeId=${selectedEmployee}`);
                if (!response.ok) {
                    // –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
                    if (response.status === 404) {
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞:', data);
                
                // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π
                if (data.data && data.data.length > 0) {
                    // –ò—â–µ–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    const completedResult = data.data.find(result => 
                        result.employeeId === selectedEmployee && result.status === 'completed'
                    );
                    
                    if (completedResult) {
                        return completedResult;
                    }
                }
                
                return null; // –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–ø—Ä–æ—Å–∞:', error);
                return null;
            }
        }

        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –°–û–¢–†–£–î–ù–ò–ö–ï ===
        function updateEmployeeInfo() {
            const employeeInfoDiv = document.getElementById('employee-info');
            
            if (selectedEmployee) {
                const employee = employees.find(emp => emp.id === selectedEmployee);
                if (employee) {
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
                    const avatarContainer = employeeInfoDiv.querySelector('.flex.items-center.space-x-3');
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª—ã –¥–ª—è —Å–ª—É—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ç–æ
                    const initials = `${employee.first_name.charAt(0)}${employee.last_name.charAt(0)}`;
                    
                    // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
                    let avatarHtml;
                    if (employee.photoUrl) {
                        avatarHtml = `<img src="${employee.photoUrl}" alt="${employee.first_name} ${employee.last_name}" class="w-10 h-10 rounded-full object-cover">`;
                    } else {
                        avatarHtml = `<div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center text-sm font-medium">${initials}</div>`;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                    avatarContainer.innerHTML = `
                        ${avatarHtml}
                        <div>
                            <p id="employee-name" class="font-medium">${employee.first_name} ${employee.last_name}</p>
                            <p id="employee-position" class="text-gray-500">${employee.position}${employee.team ? ' ‚Ä¢ ' + employee.team : ''}</p>
                        </div>
                    `;
                    
                    employeeInfoDiv.classList.remove('hidden');
                }
            } else {
                employeeInfoDiv.classList.add('hidden');
            }
        }

        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê –û–ü–†–û–°–ê ===
        async function updateSurveyStatus() {
            const statusCard = document.getElementById('survey-status-card');
            const statusContent = document.getElementById('survey-status-content');

            if (selectedSurvey && selectedEmployee) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ API
                const surveyResults = await loadSurveyResults();

                statusCard.style.display = 'block';

                if (surveyResults) {
                    // –£ –Ω–∞—Å –µ—Å—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const completedAt = new Date(surveyResults.completedAt || surveyResults.startedAt);
                    const daysAgo = Math.floor((Date.now() - completedAt.getTime()) / (1000 * 60 * 60 * 24));
                    const daysText = getDaysText(daysAgo);
                    const answersCount = surveyResults.answers ? surveyResults.answers.length : 0;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø—Ä–æ—Å–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    const survey = surveys.find(s => s.id === selectedSurvey);
                    const totalQuestions = survey?.questions?.length || answersCount;
                    const progressPercent = totalQuestions > 0 ? Math.round((answersCount / totalQuestions) * 100) : 100;

                    statusContent.innerHTML = `
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç—É—Å -->
                            <div class="lg:col-span-2 flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <i data-feather="check-circle" class="w-4 h-4 text-green-600"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <p class="font-medium text-green-800">–û–ø—Ä–æ—Å –ø—Ä–æ–π–¥–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º</p>
                                        <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω</span>
                                    </div>
                                    <p class="text-sm text-green-600">–ó–∞–≤–µ—Ä—à–µ–Ω ${daysText} ‚Ä¢ ${answersCount} –æ—Ç–≤–µ—Ç–æ–≤</p>
                                </div>
                            </div>
                            
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                                    <span class="font-medium text-green-600">${progressPercent}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-green-500 h-1.5 rounded-full" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>${answersCount}/${totalQuestions} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                                    <span>${completedAt.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' })}</span>
                                </div>
                            </div>
                        </div>
                    `;

                    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
                    document.getElementById('start-survey-btn').style.display = 'none';
                    document.getElementById('view-results-btn').style.display = 'inline-flex';
                    document.getElementById('retake-survey-btn').style.display = 'inline-flex';
                } else {
                    // –û–ø—Ä–æ—Å –Ω–µ –ø—Ä–æ–π–¥–µ–Ω - –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø—Ä–æ—Å–µ
                    const survey = surveys.find(s => s.id === selectedSurvey);
                    const totalQuestions = survey?.questions?.length || 0;
                    const estimatedTime = survey?.metadata?.estimatedDuration || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    
                    statusContent.innerHTML = `
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç—É—Å -->
                            <div class="lg:col-span-2 flex items-center space-x-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i data-feather="play-circle" class="w-4 h-4 text-blue-600"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <p class="font-medium text-blue-800">–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—é</p>
                                        <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded">–û–∂–∏–¥–∞–µ—Ç</span>
                                    </div>
                                    <p class="text-sm text-blue-600">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å</p>
                                </div>
                            </div>
                            
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                                    <span class="font-medium text-blue-600">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>0/${totalQuestions} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                                    <span>–ì–æ—Ç–æ–≤</span>
                                </div>
                            </div>
                        </div>
                    `;

                    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫—É –Ω–∞—á–∞–ª–∞ –æ–ø—Ä–æ—Å–∞
                    document.getElementById('start-survey-btn').style.display = 'inline-flex';
                    document.getElementById('view-results-btn').style.display = 'none';
                    document.getElementById('retake-survey-btn').style.display = 'none';
                }

                feather.replace();
            } else {
                statusCard.style.display = 'none';
            }
        }

        // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        function getDaysText(days) {
            if (days === 0) return '—Å–µ–≥–æ–¥–Ω—è';
            if (days === 1) return '–≤—á–µ—Ä–∞';
            if (days >= 2 && days <= 4) return `${days} –¥–Ω—è –Ω–∞–∑–∞–¥`;
            if (days >= 5 && days <= 20) return `${days} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`;
            if (days % 10 === 1 && days % 100 !== 11) return `${days} –¥–µ–Ω—å –Ω–∞–∑–∞–¥`;
            if ((days % 10 >= 2 && days % 10 <= 4) && !(days % 100 >= 12 && days % 100 <= 14)) return `${days} –¥–Ω—è –Ω–∞–∑–∞–¥`;
            return `${days} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`;
        }

        // === –î–ï–ô–°–¢–í–ò–Ø ===
        async function startSurvey() {
            if (!selectedSurvey || !selectedEmployee) return;
            
            const employee = employees.find(emp => emp.id === selectedEmployee);
            const survey = surveys.find(s => s.id === selectedSurvey);
            
            if (!employee || !survey) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–ª–∏ –æ–ø—Ä–æ—Å');
                return;
            }

            try {
                // –ù–∞—á–∏–Ω–∞–µ–º –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ API
                const response = await fetch('http://localhost:3001/api/surveys/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        surveyId: selectedSurvey,
                        employeeId: selectedEmployee
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                console.log('–û–ø—Ä–æ—Å –Ω–∞—á–∞—Ç:', data);

                // API /start —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –∏ resultId
                currentSurveyResult = { id: data.data.resultId };
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
                initializeSurveyTaking(survey, employee);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø—Ä–∏—à–µ–ª –≤ –æ—Ç–≤–µ—Ç–µ
                if (data.data.question) {
                    currentQuestion = data.data.question;
                    displayQuestion(currentQuestion);
                    updateProgress(data.data.progress);
                } else {
                    // –û–ø—Ä–æ—Å —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω
                    showSurveyCompletion();
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –æ–ø—Ä–æ—Å–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            }
        }

        async function viewResults() {
            if (!selectedSurvey || !selectedEmployee) return;
            
            const employee = employees.find(emp => emp.id === selectedEmployee);
            const survey = surveys.find(s => s.id === selectedSurvey);
            
            if (!employee || !survey) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–ª–∏ –æ–ø—Ä–æ—Å');
                return;
            }

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ API
                const surveyResults = await loadSurveyResults();
                
                if (surveyResults) {
                    const completedAt = new Date(surveyResults.completedAt || surveyResults.startedAt);
                    const answersCount = surveyResults.answers ? surveyResults.answers.length : 0;
                    
                    alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞ "${survey.title}"\n` +
                          `–°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${employee.first_name} ${employee.last_name}\n` +
                          `–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: ${completedAt.toLocaleDateString('ru-RU')}\n` +
                          `–û—Ç–≤–µ—Ç–æ–≤: ${answersCount}\n` +
                          `–°—Ç–∞—Ç—É—Å: ${surveyResults.status}\n\n` +
                          `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.`);
                } else {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞');
            }
        }

        function retakeSurvey() {
            if (!selectedSurvey || !selectedEmployee) return;
            
            const employee = employees.find(emp => emp.id === selectedEmployee);
            const survey = surveys.find(s => s.id === selectedSurvey);
            
            if (!employee || !survey) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–ª–∏ –æ–ø—Ä–æ—Å');
                return;
            }
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å "${survey.title}" –∑–∞–Ω–æ–≤–æ?\n\n–ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã.`)) {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–æ—Å –∑–∞–Ω–æ–≤–æ
                startSurvey();
            }
        }
    </script>
</body>
</html>

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ LLM Pipeline –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ one-to-one

> –î–æ–∫—É–º–µ–Ω—Ç-–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
> –°–æ–∑–¥–∞–Ω: 2024-12-04

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–±–ª–µ–º–∞

### 1.1. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–°–µ–π—á–∞—Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –æ–¥–∏–Ω LLM-–≤—ã–∑–æ–≤ –≤ `backend/src/features/assistant/`:

```
WebSocket —Å–æ–±—ã—Ç–∏–µ ‚Üí Orchestrator ‚Üí 1 LLM-–≤—ã–∑–æ–≤ ‚Üí –û—Ç–≤–µ—Ç –≤ —á–∞—Ç
```

–§–∞–π–ª—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- `orchestrator.ts` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `llm-prompt.ts` ‚Äî –ø—Ä–æ–º–ø—Ç—ã (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤)
- `context.ts` ‚Äî —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –ë–î
- `policies.ts` ‚Äî throttling (2.5 —Å–µ–∫ –º–µ–∂–¥—É –æ—Ç–≤–µ—Ç–∞–º–∏)
- `ws.ts` ‚Äî WebSocket —Å–µ—Ä–≤–µ—Ä
- `types.ts` ‚Äî —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

### 1.2. –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|---------|
| –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ | –ù–µ—Ç –ª–æ–≥–∏–∫–∏ "–º–æ–ª—á–∞—Ç—å –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ" |
| –û–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ –±–∞–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è | –û–¥–∏–Ω –ø—Ä–æ–º–ø—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ |
| –°–æ–æ–±—â–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å | –ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |
| –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (420 —Å–∏–º–≤–æ–ª–æ–≤) |

---

## 2. –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: LLM Pipeline

### 2.1. –û–±—â–∞—è —Å—Ö–µ–º–∞

```
                         ORCHESTRATOR (TypeScript-–∫–æ–¥)
                                    ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚ñº                          ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   üî¨ ANALYST    ‚îÇ       ‚îÇ   üéØ DECISION   ‚îÇ       ‚îÇ   ‚úçÔ∏è COMPOSER   ‚îÇ
‚îÇ   (LLM #1)      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   (LLM #2)      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   (LLM #3)      ‚îÇ
‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ
‚îÇ –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ ‚îÇ       ‚îÇ –ú–æ–ª—á–∞—Ç—å/–≥–æ–≤–æ—Ä–∏—Ç—å‚îÇ       ‚îÇ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∞–∂–Ω–æ:** –≠—Ç–æ –ù–ï –∞–≥–µ–Ω—Ç—ã –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏. –≠—Ç–æ —Ü–µ–ø–æ—á–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö LLM-–≤—ã–∑–æ–≤–æ–≤. –ö–∞–∂–¥—ã–π –¥–µ–ª–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É, –ø–µ—Ä–µ–¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞–ª—å—à–µ.

### 2.2. –†–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–∏–ø | LLM? | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|-----|------|-----------------|
| Orchestrator | –ö–æ–¥ | ‚ùå | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–ª–∏—Ç–∏–∫–∏ |
| Analyst | LLM | ‚úÖ | –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ø–æ–∏—Å–∫ –∏–Ω—Å–∞–π—Ç–æ–≤ |
| Decision | LLM | ‚úÖ | –†–µ—à–µ–Ω–∏–µ: –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –∏–ª–∏ –º–æ–ª—á–∞—Ç—å |
| Composer | LLM | ‚úÖ | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |

---

## 3. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3.1. ANALYST (–ê–Ω–∞–ª–∏—Ç–∏–∫)

**–ó–∞–¥–∞—á–∞:** –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏. –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface AnalystInput {
  notes: string;                    // —Ç–µ–∫—É—â–∏–µ –∑–∞–º–µ—Ç–∫–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
  employee: {
    name: string;
    position: string;
    team: string;
  };
  characteristic: string | null;   // –ø—Ä–æ—Ñ–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  previousMeetings: Array<{        // –∏—Å—Ç–æ—Ä–∏—è (3-5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)
    date: string;
    notes: string;
    satisfaction?: number;
  }>;
  openAgreements: number;          // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface AnalystOutput {
  insights: Array<{
    type: 'pattern' | 'risk' | 'opportunity' | 'contradiction' | 'trend';
    description: string;
    confidence: number;           // 0.0 - 1.0
    evidence: string[];           // —Ü–∏—Ç–∞—Ç—ã –∏–∑ –∑–∞–º–µ—Ç–æ–∫/–∏—Å—Ç–æ—Ä–∏–∏
    relevance: 'high' | 'medium' | 'low';
  }>;
  employee_state: {
    sentiment: 'positive' | 'neutral' | 'negative' | 'unknown';
    engagement_level: 'high' | 'medium' | 'low';
    key_topics: string[];
  };
  context_summary: string;        // —Å–∂–∞—Ç–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è Decision
}
```

**–ü—Ä–æ–º–ø—Ç (–∏–¥–µ—è):**
```
–¢—ã ‚Äî –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ one-to-one –≤—Å—Ç—Ä–µ—á. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –ù–ï–û–ß–ï–í–ò–î–ù–´–ï 
–∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ —Å–∏–≥–Ω–∞–ª—ã. –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å–æ–≤–µ—Ç—ã, —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π.

–ß—Ç–æ –∏—Å–∫–∞—Ç—å:
- –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—Ç –≤—Å—Ç—Ä–µ—á–∏ –∫ –≤—Å—Ç—Ä–µ—á–µ
- –†–∞–Ω–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã –≤—ã–≥–æ—Ä–∞–Ω–∏—è –∏–ª–∏ –¥–µ–º–æ—Ç–∏–≤–∞—Ü–∏–∏
- –ù–µ–≤—ã—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (—á–∏—Ç–∞–π –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫)
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º–∏ –≤—Å—Ç—Ä–µ—á–∞–º–∏

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ AnalystOutput
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM:**
- –ú–æ–¥–µ–ª—å: –æ—Å–Ω–æ–≤–Ω–∞—è (gpt-4o –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
- Temperature: 0.4 (–Ω—É–∂–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–Ω–æ—Å—Ç—å)
- Max tokens: 500

---

### 3.2. DECISION (–†–µ—à–∞—Ç–µ–ª—å)

**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ ‚Äî –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –∏–ª–∏ –º–æ–ª—á–∞—Ç—å. –≠—Ç–æ –ö–õ–Æ–ß–ï–í–û–ô –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —Ä–µ—à–∞—é—â–∏–π –ø—Ä–æ–±–ª–µ–º—É –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface DecisionInput {
  analysis: AnalystOutput;          // —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç Analyst
  context: {
    meeting_duration_minutes: number;
    messages_sent_this_session: number;
  };
  recentAssistantMessages: string[]; // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface DecisionOutput {
  should_intervene: boolean;        // –ì–õ–ê–í–ù–û–ï –ø–æ–ª–µ
  reason: string;                   // –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
  
  // –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ should_intervene = true:
  intervention_type?: 
    | 'proactive_question'          // –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–æ–ø—Ä–æ—Å
    | 'warning'                     // –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –æ —Ä–∏—Å–∫–µ
    | 'insight'                     // –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º
    | 'action_card'                 // –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ (–æ–ø—Ä–æ—Å –∏ —Ç.–¥.)
    | 'clarification';              // –ø–æ–ø—Ä–æ—Å–∏—Ç—å —É—Ç–æ—á–Ω–∏—Ç—å
  
  priority?: 'high' | 'medium' | 'low';
  insight_index?: number;           // –∫–∞–∫–æ–π –∏–Ω—Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ)
}
```

**–ü—Ä–æ–º–ø—Ç (–∏–¥–µ—è):**
```
–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∫–æ—É—á, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç: –º–æ–ª—á–∞–Ω–∏–µ —á–∞—Å—Ç–æ —Ü–µ–Ω–Ω–µ–µ —Å–ª–æ–≤.

–ú–û–õ–ß–ò (should_intervene: false), –µ—Å–ª–∏:
- –ò–Ω—Å–∞–π—Ç –±–∞–Ω–∞–ª—å–Ω—ã–π –∏–ª–∏ –æ—á–µ–≤–∏–¥–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é
- –¢—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª –ø–æ—Ö–æ–∂–µ–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
- –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å "–≤ –ø–æ—Ç–æ–∫–µ", –∞–∫—Ç–∏–≤–Ω–æ –ø–∏—à–µ—Ç ‚Äî –Ω–µ –º–µ—à–∞–π
- –ü—Ä–æ—à–ª–æ –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –Ω–∞—á–∞–ª–∞ –≤—Å—Ç—Ä–µ—á–∏ (< 5 –º–∏–Ω—É—Ç)
- –ù–µ—Ç –Ω–∏—á–µ–≥–æ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –≤–∞–∂–Ω–æ–≥–æ

–ì–û–í–û–†–ò (should_intervene: true), –µ—Å–ª–∏:
- –ó–∞–º–µ—Ç–∏–ª —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ (–≤—ã–≥–æ—Ä–∞–Ω–∏–µ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç, —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ)
- –ï—Å—Ç—å —Ü–µ–Ω–Ω—ã–π –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–π –∏–Ω—Å–∞–π—Ç —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é
- –ú–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ—â–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- –¢—Ä–µ–Ω–¥ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è (–ø–∞–¥–∞—é—â–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å)

–≠–≤—Ä–∏—Å—Ç–∏–∫–∞: "–ï—Å–ª–∏ —è —ç—Ç–æ —Å–∫–∞–∂—É ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–º–æ–∂–µ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é 
–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞—Å–æ—Ä–∏—Ç —á–∞—Ç?" –í 70-80% —Å–ª—É—á–∞–µ–≤ –æ—Ç–≤–µ—Ç = –º–æ–ª—á–∞—Ç—å.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ DecisionOutput
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM:**
- –ú–æ–¥–µ–ª—å: –±—ã—Å—Ç—Ä–∞—è/–¥–µ—à—ë–≤–∞—è (gpt-4o-mini)
- Temperature: 0.2 (–Ω—É–∂–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- Max tokens: 150

---

### 3.3. COMPOSER (–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä)

**–ó–∞–¥–∞—á–∞:** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ Decision.should_intervene = true.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ComposerInput {
  intervention_type: DecisionOutput['intervention_type'];
  insight: AnalystOutput['insights'][0];  // –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å–∞–π—Ç
  employee_name: string;
  context_summary: string;
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```typescript
interface ComposerOutput {
  message?: {
    text: string;                   // ‚â§ 280 —Å–∏–º–≤–æ–ª–æ–≤
    format: 'plain' | 'list' | 'question';
  };
  action_card?: {
    kind: 'start_survey' | 'add_agreement' | 'ask_followup';
    title: string;
    subtitle?: string;
    cta: { label: string; action: string; params?: object };
  };
}
```

**–ü—Ä–æ–º–ø—Ç—ã –ø–æ —Ç–∏–ø–∞–º (—Ä–∞–∑–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ intervention_type):**

```typescript
const composerPrompts = {
  proactive_question: `
    –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –æ–¥–∏–Ω –º–æ—â–Ω—ã–π –æ—Ç–∫—Ä—ã—Ç—ã–π –≤–æ–ø—Ä–æ—Å.
    –í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ, –∞ –Ω–µ "–¥–∞/–Ω–µ—Ç" –æ—Ç–≤–µ—Ç.
    –ò–∑–±–µ–≥–∞–π –±–∞–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π —Ç–∏–ø–∞ "–ö–∞–∫ –¥–µ–ª–∞ —Å –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π?"
    –ö–æ–Ω—Ç–µ–∫—Å—Ç: {insight}
    –ú–∞–∫—Å–∏–º—É–º 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
  `,
  
  warning: `
    –ö—Ä–∞—Ç–∫–æ –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–∏—Å–∫. –ë–µ–∑ –ø–∞–Ω–∏–∫–∏, –ø–æ-–¥–µ–ª–æ–≤–æ–º—É.
    –§–æ—Ä–º–∞—Ç: "‚ö†Ô∏è {—á—Ç–æ –∑–∞–º–µ—Ç–∏–ª} ‚Äî {–ø–æ—á–µ–º—É –≤–∞–∂–Ω–æ}"
    –ú–∞–∫—Å–∏–º—É–º 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
  `,
  
  insight: `
    –ü–æ–¥–µ–ª–∏—Å—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –∫–∞–∫ —É–º–Ω—ã–π –∫–æ–ª–ª–µ–≥–∞.
    –§–æ—Ä–º–∞—Ç: "üí° {–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ}"
    –ù–µ –ø–∏—à–∏ "–Ø –∑–∞–º–µ—Ç–∏–ª" ‚Äî –ø—Ä–æ—Å—Ç–æ —Ñ–∞–∫—Ç.
    –ú–∞–∫—Å–∏–º—É–º 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
  `,
  
  action_card: `
    –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π action_card JSON –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è.
    –¢–∏–ø: {card_kind}
  `
};
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM:**
- –ú–æ–¥–µ–ª—å: –æ—Å–Ω–æ–≤–Ω–∞—è (–¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ–∫—Å—Ç–∞)
- Temperature: 0.6 (—á—É—Ç—å –±–æ–ª—å—à–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- Max tokens: 200

---

## 4. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Orchestrator)

```typescript
async handleUserEvent(params: {
  meetingId: string;
  employeeId: string;
  lastNotes?: string;
}): Promise<Message[]> {
  
  // 1. Throttling (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
  const key = sessionKey(params.meetingId, params.employeeId);
  if (!canRespondNow(key)) return [];
  
  // 2. –°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
  const context = await buildAssistantContext(params.meetingId, params.employeeId);
  const previousMeetings = await getPreviousMeetings(params.employeeId, 5);
  
  // 3. ANALYST
  const analysis = await this.analyst.analyze({
    notes: params.lastNotes,
    employee: context.employee,
    characteristic: context.characteristic,
    previousMeetings,
    openAgreements: context.stats?.agreements_open || 0
  });
  
  // 4. DECISION
  const decision = await this.decision.decide({
    analysis,
    context: {
      meeting_duration_minutes: this.getMeetingDuration(params.meetingId),
      messages_sent_this_session: this.getMessageCount(key)
    },
    recentAssistantMessages: this.getRecentMessages(key)
  });
  
  // 5. –ï—Å–ª–∏ —Ä–µ—à–∏–ª–∏ –º–æ–ª—á–∞—Ç—å ‚Äî –≤—ã—Ö–æ–¥–∏–º
  if (!decision.should_intervene) {
    return [];
  }
  
  // 6. COMPOSER
  const selectedInsight = analysis.insights[decision.insight_index || 0];
  const composed = await this.composer.compose({
    intervention_type: decision.intervention_type!,
    insight: selectedInsight,
    employee_name: context.employee.name,
    context_summary: analysis.context_summary
  });
  
  // 7. –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  if (composed.message) {
    this.trackMessage(key, composed.message.text);
  }
  
  return composed ? [this.formatOutput(composed)] : [];
}
```

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/src/features/assistant/
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ analyst.ts           # –ö–ª–∞—Å—Å AnalystAgent
‚îÇ   ‚îú‚îÄ‚îÄ decision.ts          # –ö–ª–∞—Å—Å DecisionAgent
‚îÇ   ‚îú‚îÄ‚îÄ composer.ts          # –ö–ª–∞—Å—Å ComposerAgent
‚îÇ   ‚îî‚îÄ‚îÄ types.ts             # –¢–∏–ø—ã Input/Output –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îú‚îÄ‚îÄ analyst.prompt.ts    # –ü—Ä–æ–º–ø—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ decision.prompt.ts   # –ü—Ä–æ–º–ø—Ç —Ä–µ—à–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ composer.prompt.ts   # –ü—Ä–æ–º–ø—Ç—ã –∫–æ–º–ø–æ–∑–∏—Ç–æ—Ä–∞ (–ø–æ —Ç–∏–ø–∞–º)
‚îú‚îÄ‚îÄ orchestrator.ts          # –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ context.ts               # –†–∞—Å—à–∏—Ä–∏—Ç—å: –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å—Ç—Ä–µ—á
‚îú‚îÄ‚îÄ policies.ts              # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ ws.ts                    # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ types.ts                 # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã
```

---

## 6. –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π)

### –ò—Ç–µ—Ä–∞—Ü–∏—è 1: Decision (–≥–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

**–¶–µ–ª—å:** –Ω–∞—É—á–∏—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –º–æ–ª—á–∞—Ç—å –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
1. –°–æ–∑–¥–∞—Ç—å `agents/decision.ts`
2. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ Decision –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
3. –ï—Å–ª–∏ `should_intervene = false` ‚Äî –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º LLM –¥–ª—è –æ—Ç–≤–µ—Ç–∞

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å –Ω–∞ 50%+

**–°—Ä–æ–∫:** 1-2 –¥–Ω—è

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 2: Analyst (–≥–ª—É–±–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞)

**–¶–µ–ª—å:** –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∏–Ω—Å–∞–π—Ç–æ–≤

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
1. –°–æ–∑–¥–∞—Ç—å `agents/analyst.ts`
2. –†–∞—Å—à–∏—Ä–∏—Ç—å `context.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `getPreviousMeetings()`
3. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã –≤ Decision

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:** –∏–Ω—Å–∞–π—Ç—ã —Å—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ (—Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞)

**–°—Ä–æ–∫:** 2-3 –¥–Ω—è

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 3: Composer (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å)

**–¶–µ–ª—å:** —É–ª—É—á—à–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
1. –°–æ–∑–¥–∞—Ç—å `agents/composer.ts`
2. –†–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 280 —Å–∏–º–≤–æ–ª–æ–≤ (–∫–∞–∫ —Ç–≤–∏—Ç)

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:** —Å–æ–æ–±—â–µ–Ω–∏—è –ª–µ–≥—á–µ —á–∏—Ç–∞—Ç—å

**–°—Ä–æ–∫:** 1-2 –¥–Ω—è

---

## 7. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–∞ –±—É–¥—É—â–µ–µ)

### 7.1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Analyst

Analyst –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫:

```typescript
const analysisCache = new Map<string, {
  result: AnalystOutput;
  notesHash: string;
  timestamp: number;
}>();
```

### 7.2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å

Analyst –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º keystroke, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã–ª –≥–æ—Ç–æ–≤ –∫ –º–æ–º–µ–Ω—Ç—É debounce.

### 7.3. Fallback –Ω–∞ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å

–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –º–µ–¥–ª–µ–Ω–Ω–∞—è ‚Äî Decision –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ gpt-4o-mini –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## 8. –°–≤—è–∑—å —Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–º–∏ —Ñ–∏—á–∞–º–∏

| –§–∏—á–∞ –∏–∑ prodIdea.md | –ö–∞–∫ pipeline –ø–æ–º–æ–≥–∞–µ—Ç |
|---------------------|----------------------|
| –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã/–∏–¥–µ–∏ | Composer —Å —Ç–∏–ø–æ–º `proactive_question` |
| –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ | Analyst —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å previousMeetings |
| –í—ã—è–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π | Analyst.employee_state.sentiment + —Ç—Ä–µ–Ω–¥—ã |
| –í–∑–∞–∏–º–æ—Å–≤—è–∑—å –æ—Ü–µ–Ω–æ–∫ –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ | Analyst –ø–æ–ª—É—á–∞–µ—Ç satisfaction scores |

---

## 9. –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: –ù–∞—Å—Ç–æ—è—â–∏–π –∞–≥–µ–Ω—Ç

–ü–æ—Å–ª–µ pipeline –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á:
- –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤—Å—Ç—Ä–µ—á–µ

–≠—Ç–æ —É–∂–µ –Ω–∞—Å—Ç–æ—è—â–∏–π –∞–≥–µ–Ω—Ç —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ —Ü–∏–∫–ª–æ–º –¥—É–º–∞—Ç—å‚Üí–¥–µ–ª–∞—Ç—å‚Üí–Ω–∞–±–ª—é–¥–∞—Ç—å.

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.*

